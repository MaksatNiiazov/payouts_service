Отлично. Ниже — **переписанный README глазами интервьюера**, короче, плотнее и сильнее.
Без воды, с акцентом на **надёжность, финтех и инженерные решения**.

Можешь **заменить текущий README.md целиком**.

---

# Payouts Service

REST-сервис для управления заявками на выплату средств с асинхронной обработкой.
Проект сделан как мини-финтех-система с фокусом на надёжность, транзакционную целостность и предсказуемость фоновых процессов.

---

## Стек

* Python 3.12
* Django 4.2, Django REST Framework
* PostgreSQL
* Celery + Redis
* Poetry
* Docker / docker-compose
* pytest
* Swagger / Redoc (drf-spectacular)

---

## Ключевые инженерные решения

* **Транзакционная постановка задач**
  Celery-задачи ставятся через `transaction.on_commit`, что исключает обработку незафиксированных данных.

* **Идемпотентные фоновые задачи**
  Повторный запуск или retry Celery не приводит к неконсистентному состоянию.

* **Защита от race conditions**
  Используется блокировка строк БД (`select_for_update`) при изменении статусов.

* **Чистое разделение ответственности**
  HTTP-слой, бизнес-логика и асинхронная обработка разделены.

---

## Модель данных

**Заявка на выплату**:

* сумма (`Decimal`)
* валюта (whitelist)
* реквизиты получателя
* статус: `created → processing → completed / failed`
* комментарий (опционально)
* даты создания и обновления

Статусы реализованы через enum, переходы валидируются.

---

## API

```
GET    /api/payouts/          список заявок
GET    /api/payouts/{id}/     получение заявки
POST   /api/payouts/          создание заявки
PATCH  /api/payouts/{id}/     обновление статуса
DELETE /api/payouts/{id}/     удаление заявки
```

---

## Документация API

* Swagger UI
  [http://127.0.0.1:8000/api/docs/swagger/](http://127.0.0.1:8000/api/docs/swagger/)

* Redoc
  [http://127.0.0.1:8000/api/docs/redoc/](http://127.0.0.1:8000/api/docs/redoc/)

* OpenAPI schema
  [http://127.0.0.1:8000/api/schema/](http://127.0.0.1:8000/api/schema/)

---

## Асинхронная обработка

1. Заявка создаётся в транзакции
2. Celery-задача ставится **только после коммита**
3. Обработка выполняется с блокировкой строки БД
4. Повторные запуски задачи безопасны

Такой подход предотвращает:

* гонки,
* двойную обработку,
* частичные сбои.

---

## Тесты

Тесты написаны с использованием `pytest` и покрывают:

* создание заявки,
* валидацию входных данных,
* вызов Celery-задачи,
* идемпотентность фоновой обработки.

Запуск:

```bash
make test
```

---

## Запуск проекта

### Требования

* Docker
* Docker Compose

### Запуск

```bash
make up
```

API будет доступно по адресу:

```
http://127.0.0.1:8000/api/payouts/
```

---

## Основные команды

```bash
make up        # запуск сервиса
make down      # остановка
make logs      # логи
make migrate   # миграции
make test      # тесты
make shell     # django shell
```

---

## Деплой (концепция)

В продакшене сервис предполагается запускать как:

* Django + Gunicorn
* Celery worker отдельным процессом
* Redis или RabbitMQ
* PostgreSQL
* конфигурация через переменные окружения
* миграции при релизе
* healthchecks и мониторинг

Docker-окружение позволяет воспроизводимо развернуть сервис в любой среде.

---

## Автор

Максат Ниязов
Backend Developer (Python, Django, асинхронные системы)

---
